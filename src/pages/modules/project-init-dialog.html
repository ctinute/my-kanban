<link rel="import" href="./../../../bower_components/polymer/polymer-element.html">
<link rel="import" href="./../../../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="./../../../bower_components/paper-button/paper-button.html">
<link rel="import" href="./../../../bower_components/paper-input/paper-input.html">

<link rel="import" href="./../../api/project-data.html">
<link rel="import" href="./../../shared-styles.html">

<dom-module id="project-init-dialog">
  <template>
    <style include="shared-styles">
      :host {
        width: 100%;
        height: 100%;
        display: flex;
        justify-content: center;
        align-items: center;
      }
    </style>

    <project-db id="projectDB"></project-db>

    <paper-dialog id="dialog" opened="{{opened}}">
      <div class="modal-header">
        <h2>New project</h2>
      </div>  
      <div class="modal-content">
          <paper-input required auto-validate
            label="Project name" 
            value="{{newProject.name}}"
            error-message="This field is required !!!">
          </paper-input>
      </div>
      <div class="modal-actions">
        <paper-button dialog-dismiss>Cancel</paper-button>
        <paper-button dialog-confirm on-click="_createNewProject">Create</paper-button>
      </div>
    </paper-dialog>

  </template>

  <script>
    class ProjectInitDialog extends Polymer.Element {

      static get is() {
        return 'project-init-dialog';
      }

      static get properties() {
        return {
          opened: {
            type: Boolean,
            value: false
          },
          user: {
            type: Object
          },
          newProject: {
            type: Object,
            value: {}
          }
        };
      }

      _generateRandomId() {
        return Math.round(Math.random()*1000000);
      }

      open() {
        this.opened = true;
      }

      close() {
        this.opened = false;
      }

      toggle() {
        this.opened = !this.opened;
      }

      _showSuccessMessage(){}

      _navigateProject(){}

      _createNewProject() {
        this.$.projectDB.saveOrUpdate(null, this.newProject)
          .then(resp => {
            this.close()
            this._showMessage('Success! Redirecting to project dashboard...', 1500)
          })
          .catch(error => {
            this.$.close()
            this._showMessage(error.message, 0)
          })
      }

      _showMessage(text, duration) {
        this.dispatchEvent(new CustomEvent('require-toast', {
          bubbles: true,
          composed: true,
          detail: {
            toastConfigs: {
              text,
              duration
            }
          }
        }));
      }

    }

    window.customElements.define(ProjectInitDialog.is, ProjectInitDialog);
  </script>
</dom-module>