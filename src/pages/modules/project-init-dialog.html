<link rel="import" href="./../../../bower_components/polymer/polymer-element.html">
<link rel="import" href="./../../../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="./../../../bower_components/paper-button/paper-button.html">
<link rel="import" href="./../../../bower_components/paper-input/paper-input.html">
<link rel="import" href="./../../redux-mixin.html">
<link rel="import" href="./../../api/project-data.html">
<link rel="import" href="./../../shared-styles.html">

<dom-module id="project-init-dialog">
    <template>
        <style include="shared-styles">
            :host {
                width: 100%;
                height: 100%;
                display: flex;
                justify-content: center;
                align-items: center;
            }
        </style>

        <paper-dialog id="dialog" opened="{{opened}}">
            <div class="modal-header">
                <h2>New project</h2>
            </div>
            <div class="modal-content">
                <paper-input required auto-validate label="Project name" value="{{newProject.name}}" error-message="This field is required !!!">
                </paper-input>
            </div>
            <div class="modal-actions">
                <paper-button dialog-dismiss>Cancel</paper-button>
                <paper-button dialog-confirm on-click="_createNewProject">Create</paper-button>
            </div>
        </paper-dialog>

    </template>

    <script>
        class ProjectInitDialog extends ReduxMixin(Polymer.Element) {

            static get is() {
                return 'project-init-dialog';
            }

            static get properties() {
                return {
                    opened: {
                        type: Boolean,
                        value: false
                    },
                    user: {
                        type: Object
                    },
                    newProject: {
                        type: Object,
                        value: {}
                    }
                };
            }

            static get actions() {
                return {
                    showToastMessage(message, duration) {
                        return {
                            type: 'APP_GLOBAL_TOAST_SHOW',
                            payload: {
                                message,
                                duration,
                            }
                        }
                    },
                    showFetching(message, duration) {
                        return {
                            type: 'APP_SET_FETCHING',
                            payload: { isFetching: true }
                        }
                    },
                    hideFetching(message, duration) {
                        return {
                            type: 'APP_SET_FETCHING',
                            payload: { isFetching: false }
                        }
                    },
                    createProject(project) {
                        return function (dispatch) {
                            dispatch('showFetching')
                            projectDb.save(project)
                                .then(resp => {
                                    dispatch('showToastMessage',
                                        'Success! Redirecting to project dashboard...', 1500)
                                })
                                .catch(error => {
                                    dispatch('showToastMessage', error.message, 0)
                                })
                                .finally(() => dispatch('hideFetching'))
                        }
                    }
                }
            }

            open() {
                this.opened = true;
            }

            close() {
                this.opened = false;
            }

            toggle() {
                this.opened = !this.opened;
            }

            _showSuccessMessage() {}

            _navigateProject() {}

            _createNewProject() {
                this.dispatch('createProject', this.newProject)
            }

        }

        window.customElements.define(ProjectInitDialog.is, ProjectInitDialog);
    </script>
</dom-module>