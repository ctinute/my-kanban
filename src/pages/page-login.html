<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/polymerfire/firebase-auth.html">
<link rel="import" href="../../bower_components/iron-localstorage/iron-localstorage.html">
<link rel="import" href="../shared-styles.html">

<dom-module id="page-login">
  <template>
    <style include="shared-styles">
      :host {
        width: 100%;
        height: 100%;
        display: flex;
        justify-content: center;
        align-items: center;
      }

      paper-button {
        text-transform: none;
        background-color: white;
      }
    </style>

    <firebase-auth 
      id="auth"
       user="{{user}}" 
       provider="google"
       on-signed-in-changed="_onSignedInChanged"></firebase-auth>

    <paper-button raised on-click="_login">Login with Google
      <img src="../images/google-24x24.png" alt="google-icon">
    </paper-button>

  </template>

  <script>
    class PageLogin extends Polymer.Element {
      static get is() {
        return 'page-login';
      }

      static get properties() {
        return {
          user: {
            type: Object
          }
        };
      }

      _login() {
        this.$.auth.signInWithPopup()
          .then(() => this._redirectToDashboard())
          .catch(e => this._alertError());
      }

      _redirectToDashboard() {
        window.location = '/dashboard';
      }

      _alertError(error) {
        this.dispatchEvent(new CustomEvent('require-toast', {
          bubbles: true,
          composed: true,
          detail: {
            toastConfigs: {
              text: error.message,
              horizontalAlign: 'right',
              duration: 0,
              noCancelOnOutsideClick: false
            }
          }
        }));
      }
    }

    window.customElements.define(PageLogin.is, PageLogin);
  </script>
</dom-module>