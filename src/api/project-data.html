<link rel="import" href="./../../bower_components/polymerfire/firebase-database-script.html">

<script>
    const db = firebase.database()

    const projectDb = {}

    projectDb.checkKey = key => {
        var isExisted = false
        db.ref('/projects/').child(key).once('value', snapshot => {
            isExisted = snapshot.exists()
        });
        return isExisted
    }

    projectDb.getByKey = key => {
        return db.ref(`/projects/${key}`).once('value')
    }

    projectDb.getByUserId = uid => {
        return db.ref(`/projectsNyUser/${uid}`).once('value')
    }

    projectDb.getByCurrentUser = () => {
        return db.ref(`/projectsByUser/${firebase.auth().currentUser.uid}`).once('value')
    }

    projectDb.save = (data) => {
        const key = db.ref().child('/projects/').push().key
        const updates = {}
        updates[`/projects/${key}`] = data;
        updates[`/projectsByUser/${firebase.auth().currentUser.uid}/${key}`] = { name: data.name }
        return db.ref().update(updates)
    }

    projectDb.update = (key, data) => {
        const updates = {}
        updates[`/projects/${key}`] = data;
        updates[`/projectsByUser/${firebase.auth().currentUser.uid}/${key}`] = { name: data.name }
        return db.ref().update(updates)
    }

    projectDb.deleteByKey = key => {
        return db.ref(`/projects/${key}`).remove()
    }

</script>