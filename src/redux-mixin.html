<!-- src/demo-app/redux-mixin.html -->

<link rel="import" href="./../bower_components/polymer-redux/polymer-redux.html">

<script>
    // Setup a Redux store
    const initialState = {
        app: {
            isLoading: false,
            isFetching: false,
            globalToast: {
                show: false,
                message: null,
                duration: 0
            }
        },
        auth: {
            user: null
        },
        userData: {
            projects: []
        }
    };

    const rootReducer = (state, action) => {
        console.log(`=== INCOMMING ACTION =====================================`);
        console.log(action.type);
        console.log(`--- prev state ---`);
        console.log(state);
        
        var nextState = state;
        switch (action.type) {

            case 'AUTH_SAVE_USER':
                break;
            case 'AUTH_REMOVE_USER':
                break;

            case 'APP_SET_LOADING':
                nextState = Object.assign({}, state, {
                    app: {
                        ...state.app,
                        isLoading: action.payload.isLoading
                    }
                });
                break;

            case 'APP_SET_FETCHING':
                nextState = Object.assign({}, state, {
                    app: {
                        ...state.app,
                        isFetching: action.payload.isFetching
                    }
                })
                break;

            case 'APP_GLOBAL_TOAST_SHOW':
                nextState = Object.assign({}, state, {
                    app: {
                        ...state.app,
                        globalToast: {
                            show: true,
                            message: action.payload.message,
                            duration: action.payload.duration
                        }
                    }
                });
                break;

            case 'APP_GLOBAL_TOAST_DISMISS':
                nextState = Object.assign({}, state, {
                    app: {
                        ...state.app,
                        globalToast: {
                            show: false,
                            message: null,
                            duration: 0
                        }
                    }
                });
                break;

            default:
                break;
        }

        console.log(`--- next state ---`);
        console.log(nextState);
        return nextState;
    };

    const store = Redux.createStore(
        rootReducer,
        initialState,
        Redux.applyMiddleware(ReduxThunk.default)
    );

    // Export the ReduxMixin
    ReduxMixin = PolymerRedux(store);
</script>